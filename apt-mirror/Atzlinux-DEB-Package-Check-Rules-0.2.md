# ADPCR-0.2

# Atzlinux DEB 软件包测试规范 (版本 0.2)

# Atzlinux DEB Package Check Rules (version 0.2)

* 版本: 0.2（草案）
* 拟稿: 
* 更新日期: 2020-12-13

## 一、适用目标和范围

 DEB 格式的 Linux 软件包。通常适用于以下 Linux 版本，以及相应的衍生版本。如: 

* Debian
* Ubuntu, UbuntuKylin
* LinuxMint, LMDE
* Deepin, UOS
* Spark-store (星火应用商店。即 Deepin 和 UOS 的社区 DEB 包应用商店) 

* Atzlinux 项目组收录的第三方 DEB 包（包括软件厂商官方发布的软件包），以及 Atzlinux 项目组制作/维护/修改/优化/打补丁的 DEB 软件包。
 
## 二、测试项目: 

### 1. 对 DEB 包进行 lintian 检查。

### 2. 进行安装测试、启动测试、卸载测试。

2.1 “安装测试”包含两组: 

* apt-get install XXX.deb

* dpkg -i XXX.deb 


2.2 “启动测试”包括: 

* 在命令行（或终端），直接运行主程序命令，以及其它主要的附加程序命令。

2.3 “卸载测试”

### 3. 包名变更后的“升级安装测试”（仅适用于软件包存在多个名称的情况）。

* 示例1: 如 zwcad （中望CAD）软件，Kylin 适配版的 DEB 包名为 zwcad-linuxpreinst。
而 Deepin/UOS 适配版的包名为 com.zwsoft.zwcad

## 三、测试后的 DEB 软件包质量等级评定标准（草案）

质量等级: 由高到低，依次分为 A/B/C/D/E 共五大类。

* A/B/C 类: 能正常启动程序的（如可执行程序），或者实现功能调用的（如: 字体包、图标资源包、中国象棋电子棋谱文件）。

* D 类（无法实现基本功能）。

* E 类: 暂未进行测试，或暂未提交测试结果。

详细分类定义: 

### A类（高质量）

101: 打包质量基本达到可以直接提交到 Debian/Ubuntu 的档次；

102: lintian 检测，异常信息输出（主要是 X/E/W 这三类），已控制到最少；

103: 必要时，可以包含 lintian overrides 文件。

### B类（质量中等）

相关缺陷代码定义: 

201: md5sums 文件清单校验文件异常。如: 

* 201A: 未包含 DEBIAN/md5sums 文件清单校验文件；
* 201B: 或者文件与校验码不匹配；
* 201C: 有校验码无文件；
* 201D: 有文件无校验码。

202: changelog 文件不规范。如: 

* 202A: 无 doc/changelog.Debian 文件，也无 doc/changelog 文件；
* 202B: 文件存在，但实际内容空缺；
* 202C: 文件格式严重不规范。

203: copyright 文件不规范。如: 

* 203A: 无 doc/copyright 文件；
* 203B: 文件存在，但实际内容空缺；
* 203C: 文件格式严重不规范（如存在空白模板字段未清理）。

204: 安装后，无 /usr/share/applications/XXX.desktop 桌面菜单项文件
（包括通过安装脚本如 postinst 创建的符号链接），
但是在其它目录下存在 XXX.desktop 文件（常见于 Deepin/UOS 适配的某些第三方软件包）；

205: desktop 桌面菜单项文件异常。如: 
* 有 XXX.desktop 桌面菜单项文件，但是直接运行命令时，对应的图标显示异常（不显示图标，或者显示为其它图标）；
* 内部标签值定义语法不符合标准分类或规范（如 Mimetype 或分类 字段后面分号缺失）。

206: DEBIAN/control 文件中，多处标签值填写不符合标准定义，或者标签值填写不完整（如维护人信息中，缺失 e-mail 信息）；

207: DEBIAN/control 文件中，未对同一包名的多个版本名称，设定 冲突/替换/已提供 等标签进行处理，导致升级安装时，因文件冲突，导致安装失败。

* 异常示例1: 
某软件包，针对 Kylin Linux 的适配包，包名为 XXX；针对 Deepin/UOS Linux 的适配包，包名为 com.AAA.XXX。这两个同一来源，不同编译版本的包，安装时通常不能共存。

* 异常示例2: 
某输入法软件包，旧版本的包名和版本号为 fcitx-xxx 0.1, 新版本名调整为 xxx 0.2。在已安装 fcitx-xxx 0.1 的系统上，直接升级到 xxx 0.2 时，报错“文件冲突”导致升级安装失败。 


299: 其它缺陷。

### C类（质量一般。属于“能用”的档次阶段）


301: 大量文件/目录权限异常。包括: 

* 301A: 普通目录，权限非 755。异常示例: 某目录，权限误为 777 或 775。

* 301B: 普通文件，权限非 644。异常示例: 某图片文件，权限误为 755 （可执行）或 664。

* 301C: 主要的可执行文件，或者 deamon 守护进程，权限非 755。异常示例: 某主程序相关的 bash 脚本程序，权限误为 644 （不可执行权限）。

302: 大量文件/目录属主异常；

303: 存在无意义的安装脚本未删除(包括 preinst, postinst, prerm, postrm)；

304: 安装脚本中，存在错误的，或者不必要的高风险指令; 

305: DEBIAN/control 中架构定义不规范。示例: 

* 某字体包、输入法皮肤包、文档包、图标资源包，架构应为 all, 误设定为 amd64 或者 i386；

* 实为 i386 的软件包，误标为 amd64，且经 amd64 平台测试验证，确认为 amd64 无法使用。
但本包中的某些文件或资源，能被其它程序和软件包借用和调取，仅提供参考借鉴功能和价值。


390: 中文处理存在功能缺陷

如: 某文档处理软件/行业软件，英文显示、处理、保存、重新读取正常，但中文输入、显示、处理、保存、重新读取时，乱码或文件损坏。

399: 其它严重缺陷。


### D 类（无法实现基本功能）

异常码定义: 

401: 可执行程序，无法启动运行；

402: 某文档处理软件，保存文件时，异常退出；

499: 其它异常。 


### E 类: 暂未进行测试，或未对测试结果进行汇总成文
